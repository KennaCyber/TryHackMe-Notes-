# What is SIEM

- Security Information and Event Management system

    1. Collects data from various endpoints(any device that connects to a computer network)/network devices across the network
    
    2. Stores them at a centralized place(saves that info in one main system, usually a SIEM)

    3. Performs correlation on them (finds patterns to find suspicious activity)

---

**Network Visibility through SIEM üåê**

Image shows a network with Linux/Windows based endpoints, one data server, and one website. They all communicate & reach the internet through a router

- Each network component(parts that makes up a computer network) can have one or more log sources generating different logs(logs are like journal entries that record whats happening)
 
    - It's like your house having different smart devices, each logging different types of activities
 
1. Host-Centric Log Sources (host = any device connected to a network that can send or receive data)

Log sources that capture events that occured within or related to the host.

Examples of host-centric log sources:
   
  - Windows Event logs, Sysmon, Osquery

Example of host-centric logs:

  - User accessing file & attempting to authenticate (someone trying to get in and what they're trying to access)

  - a process Execution Activity (program or script starts running)

  - A process adding, editing, deleting a registry key or value (changes system settings)
    
  - Powershell execution 

2. Network-Centric Log sources

These logs are generated when the hosts communicate with each other or access the internet to visit a website

Examples of network-based protocols (set of rules devices follow to commuicate over a network):

  - SSH connection

  - File accessed via FTP

  - Web traffic

  - User accessing company's resources through VPN

  - Network file sharing activity

**Importance of SIEM**

- Investigating hundreds of events that generate per second on each device can be tedious

- SIEM takes log from various sources and can correlate between events, search through them, investigate and respond

Key features provided by SIEM are:
 
  - Real-time log ingestion (See everything as it happens)
 
  - Alerting against abnormal activities
 
  - 24/7 Monitoring and visibility
 
  - Protection against latest threats through early detection
 
  - Data insights and visualization (turns raw data into graphs, dashboards, etc)
 
  - Ability to investigate past incidents

---

**Log Sources and Log Ingestion üìäüîÅ**

Every device in the network generates logs when there is activity on it

  - Example: User visits a website, connects to SSH, logging into workstation

Windows Machine

- Windows records every event (Viewed in Event Viewer utility)

- Assigns unique ID to each type of log activity

- Type "Event Viewer" in the search bar

- These logs are forwarded to the SIEM solution (for monitoring and better visibility)

Linux Workstation

- Linux OS stores all the related logs (events, errors, warnings, etc)

- Common locations where linux stores logs:
<pre>
/var/log/httpd  - Contains HTTP Request / Response and error logs
/var/log/cron  - Events related on cron jobs (command that system runs on its own) are stored in this location
/var/log/auth.log and var/log/secure  - Stores authentication related logs
/var/log/karn  - This file stores kernel related events (generated by linux kernel, the core part of the OS, the brain)
</pre>

var- Variable(Stores files that change frequently)
/var/log - Central log directory
/var/log/httpd - Stores logs for apache HTTP Server

**Web Server**

- Important to look at requests/responses in and out of the webserver (for potential web attack attempt)

- In Linux, common locations to write all apache(apache = web server software, listens for
requests like "show me this webpage" and sends back the content so browser can display it) related logs are
<pre>
/var/log/apache or /var/log/httpd
</pre>

**Log Ingestion**

Logs provide a wealth of info that can help identify security issues. Each SIEM solution has its own way of ingesting the logs:

1) Agent / Forwarder

    - Small tool installed on each device(forwarder by Splunk), collects important logs and sends them to the SIEM system.
  
2) Syslog:

    - Commonly used protocol used to send real-time data from systems like web servers or databases to a centralized destination 

3) Manual Upload:

    - You can manually upload log files into the SIEM (Like Splunk or ELK) for analysis. The SIEM organizes the data so it's easy to search and understand

4) Port-Forwarding:

    - The SIEM listens on a specific network port, and devices send their logs directly to that port (so SIEM collects them)
  
---

**Why SIEM üõ°Ô∏èüö®**

SIEM is used to provide correlation on the collected data to detect threats

Once a threat is detected/thredhhold is crosses, it sends an alert 
Analysts can then investigate it

Provides good visibility of whats happening within the network infrastructure

**SIEM Capabilities**

Major component of a SOC (Security Operations Center) ecosystem

- Correlation between events from different log sources

- Visiblity on both Host-centrc and Network-centric activities

- Allows analysts to investigate latest threats and timely responses

- Hunts threats not detected by rules in place

**SOC Analyst Responsibilities**

- Monitoring and investigating

- Identifying false positives

- Tuning rules causing the noise/false positives

- Reporting and compliance

- Identifying blind in the network visibility spots and covering them

---

**Analyzing Logs and Alerts üîç**

SIEM tool gets security related logs ingested through agents, port forwarding, etc.

Once ingested, SIEM looks for suspicious pattern/unwanted behavior within the logs with the help of the conditions set in the rules by the analysts

Condition is met = incident is investigated

**Dashboard**

Important component of any SIEM.

Presents the data for analysts after being normalized (standard format) and ingested 

Each SIEM solution comes with some default dashboards & provides an option for custom Dashboard creation

Some info that can be found in a dashboard are:

- Alert highlights

- System notification

- Health alert

- List of failed login attempts

- Events ingested #
  
- Rules triggered

- Top domains visted

**Correlation Rules**

Correlation plays an important role in the timely detection of threats, allowing analysts to take action on time

Logical expressions set to be triggered

Example:

User gets 5 failed Login Attempts in 10 seconds
<pre>
Multiple Failed Login Attempts
</pre>

Becomes successful

<pre>
Successful Login After multiple Login Attempts
</pre>

Rule for when user plugs in a USB

Traffic is > 25 MB - Raise an alert for potential Data exfiltration Attempt (copying, transferring, retrieving data)

**How a correlation rule is created**

Correlation rule = logical condition that monitors specific field-value combinations across ingested logs. If met, SIEM triggers alert. Backbone of threat detection in a SOC.

Use-Case 1 üéØ Threat Behavior

Scenario: Adersary tries to erase evidence post-exploitation

Log source: WinEventLog

Generates Event ID: 104 (Event log clear)

Rule Logic:
<pre>
If LogSource = WinEventLog AND EventID  104
THEN Trigger Alert: "Event Log Cleared"
</pre>

User-Case 2 üéØ Threat Behavior

Adversary checks privileges after escalation

Log Source: WinEventLog

Generated Event ID: 4688 (Process Start)

NewProcessName: Contains whoami

Rule Logic:
<pre>
If LogSource = WinEventLog AND EventID = 4688 AND NewProcessName CONTAINS "whoami"
'WHOAMI Command Execution Detected"
</pre>

SIEM rules rely on normalized logs. Each source 9Windows, Linux, firewalls, web servers, etc) have their own format. Normalization converts these into consistent schema. 

Fields like EventID, ProcessName, and Logsource are key to building precise rules.

**Alert Investigation**

Once a rule triggers an alert, analysts follow this process:

1. Determine if alert is False or True Positive

2. If False positive -> Tune rule to reduce noise

3. If True Positive -> Investigate further

4. Contact asset owner for context

5. If confirmed malicious -> Isolate host, block IP

